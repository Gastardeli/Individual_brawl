<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Brawl Stars | Cadastro</title>
  <link rel="stylesheet" href="css/cadastro_login.css">
  <link rel="stylesheet" href="css/style.css">

  <link rel="stylesheet" href="teste_modal.css">
  <script src="js/modal.js"></script>

</head>

<body>
  <header>
    <div class="container">
      <div class="logo">
        <img src="assets/img/LOGO.png" alt="">
      </div>
      <div class="pages">
        <a href="index.html">Home</a>
        <a href="conta.html">Conta</a>
        |
        <div class="red_box">
          <a href="login.html">Login</a>
          <a href="#" class="now">Cadastro</a>
        </div>
      </div>
    </div>
  </header>
  <main>
    <div class="modal_erro" id="modal_erro" style="display: none;">
      <div class="conteudoModal">
        <div class="titulo">Aviso!</div>
        <div class="img">
          <img src="assets/img/nita.png" alt="">
        </div>
        <div class="mensagem">
          <div id="conteudoMensagem">

          </div>
        </div>
        <button onclick="sumirMensagem()">Ok</button>
      </div>
    </div>
    <div class="container">
      <div class="modal">
        <div class="titulo">
          Cadastro
        </div>
        <div class="inputs">
          <div class="cima">
            <div class="um">
              <input type="text" placeholder="Nome:" id="nome_input">
              <input type="text" placeholder="Email:" id="email_input">
            </div>
            <div class="dois">
              <input type="text" placeholder="CPF:" id="cpf_input">
              <input type="password" placeholder="Senha:" id="senha_input">
            </div>
          </div>
          <div class="baixo">
            <input type="password" placeholder="Confirmar senha:" id="confirmacao_senha_input">
          </div>
        </div>
        <div class="botao">
          <button onclick="cadastrar()">Cadastre-se</button>
        </div>
        <div class="msg">
          <p>Ja tem cadastro? faça <a href="login.html">LOGIN</a></p>
          <div id="sucesso"></div>
        </div>
        <div id="div_aguardar" class="loading-div" style="display: none; margin: 10px 0px;">
          <img width="50px" height="50px" src="./assets/icon/aguarde-orange.gif" id="loading-gif" />
        </div>

      </div>

      <div id="div_erros_login"></div>
    </div>
  </main>
  <footer>
    <p>Made By | Victor G - 2025</p>
  </footer>
</body>

</html>

<script>

  

  function cadastrar() {



    // aguardar();

    //Recupere o valor da nova input pelo nome do id
    // Agora vá para o método fetch logo abaixo
    var nomeVar = nome_input.value;
    var emailVar = email_input.value;
    var senhaVar = senha_input.value;
    var cpfVar = Number(cpf_input.value);
    var confirmacaoSenhaVar = confirmacao_senha_input.value;

    var caracteresEspeciais = ['!', '#', '$', '%', '&', '(', ')', '*', '+', ',', '/', '<', '>', '?', '^', '|']
    var incluiCaracater = false
    var temMinuscula = false
    var temMaiscula = false
    var TemtamanhoSenha = false
    var senhasCoecidem = false
    // se tem MAISCULO senha != senha.tolowercase
    // se tem MINUSCULA senha != senha.toupercase
    // senha.length < 8 `
    conteudoMensagem.innerHTML = `Sua senha deve atender as todos os requisitos: <br><br>`

    if (senhaVar != senhaVar.toLowerCase()) {
      temMaiscula = true
      conteudoMensagem.innerHTML += `<p>Sua senha possui <span style="color: green">POSSUI</span> caracteres maisculos</p><br>`
    } else {
      conteudoMensagem.innerHTML += `<p>Sua senha <span style="color: red">NÃO POSSUI</span> caracteres maisculos</p><br>`
    }

    if (senhaVar != senhaVar.toUpperCase()) {
      temMinuscula = true
      conteudoMensagem.innerHTML += `<p>Sua senha <span style="color: green">POSSUI</span> caracteres minúsculos</p><br>`
    } else {
      conteudoMensagem.innerHTML += `<p>Sua senha <span style="color: red">NÃO POSSUI</span> caracteres minúsculos</p><br>`
    }

    var tamanhoSenha = (senhaVar.length)

    if (tamanhoSenha < 8) {
      conteudoMensagem.innerHTML += `<p>Sua senha <span style="color: red">NÃO POSSUI</span> pelo menos 8 caracteres</p><br>`
    } else {
      TemtamanhoSenha = true
      conteudoMensagem.innerHTML += `<p>Sua senha <span style="color: green">POSSUI</span> pelo menos 8 caracteres</p><br>`
    }

    for (var i = 0; i < caracteresEspeciais.length; i++) {
      var atual = caracteresEspeciais[i]
      if (senhaVar.includes(atual)) {
        incluiCaracater = true
        i = caracteresEspeciais.length
        conteudoMensagem.innerHTML += `<p>Sua senha <span style="color: green">POSSUI</span> caracteres especiais</p><br>`
      }
    }
    if (incluiCaracater == false) {
      conteudoMensagem.innerHTML += `<p>Sua senha <span style="color: red">NÃO POSSUI</span> caracteres especiais</p><br>`
    }






    // Verificando se há algum campo em branco
    if (
      nomeVar == "" ||
      emailVar == "" ||
      senhaVar == "" ||
      confirmacaoSenhaVar == "" ||
      cpfVar == ""
    ) {
      conteudoMensagem.innerHTML = `Ops! Parece que você deixou algum campo em branco! tente novamente`;
      chamarModal();
    } else if (incluiCaracater == false ||
      temMaiscula == false ||
      temMinuscula == false ||
      TemtamanhoSenha == false) {
      chamarModal();
    } else if (senhaVar != confirmacaoSenhaVar) {
      conteudoMensagem.innerHTML = `Ops! Parece que suas senhas não coincidem`;
      chamarModal();
    } else if (isNaN(cpfVar)) {
      conteudoMensagem.innerHTML = `Certifique-se que seu CPF contém apenas números e 11 dígitos`;
      chamarModal();
    } else {

      // Enviando o valor da nova input
      fetch("/usuarios/cadastrar", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          // crie um atributo que recebe o valor recuperado aqui
          // Agora vá para o arquivo routes/usuario.js
          nomeServer: nomeVar,
          emailServer: emailVar,
          senhaServer: senhaVar,
          cpfServer: cpfVar
        }),
      })
        .then(function (resposta) {
          console.log("resposta: ", resposta);

          if (resposta.ok) {
            div_aguardar.style.display = 'flex';
            sucesso.innerHTML =
              `<br> Cadastro realizado com sucesso! Redirecionando para tela de Login...`;

            setTimeout(() => {
              window.location = "login.html";
            }, "2000");
          } else {
            conteudoMensagem.innerHTML = `Ops! Parece que Houve um erro ao tentar realizar o cadastro!`;
            chamarModal();
            throw "Houve um erro ao tentar realizar o cadastro!";
          }
        })
        .catch(function (resposta) {
          console.log(`#ERRO: ${resposta}`);
        });

      return false;
    }
  }

 
</script>